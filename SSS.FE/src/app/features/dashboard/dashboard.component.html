<div class="dashboard-container" [@cardSlideIn]>
  <!-- Welcome Section -->
  <section class="welcome-section" #welcomeSection>
    <div class="welcome-content">
      <div class="welcome-text">
        <h1 class="welcome-title">{{ welcomeMessage }}</h1>
        <p class="welcome-subtitle">{{ formatDate(currentTime) }}</p>
        <p class="welcome-description">
          Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi h·ªá th·ªëng qu·∫£n l√Ω nh√¢n s·ª± SSS. 
          B·∫°n ƒëang ƒëƒÉng nh·∫≠p v·ªõi quy·ªÅn <strong>{{ getUserRole() }}</strong>.
        </p>
      </div>
      <div class="welcome-time">
        <div class="time-display">
          <span class="current-time">{{ formatTime(currentTime) }}</span>
          <span class="time-label">Gi·ªù hi·ªán t·∫°i</span>
        </div>
        <button class="refresh-btn" (click)="refreshDashboard()" [disabled]="isLoading">
          <svg class="refresh-icon" [class.spinning]="isLoading" viewBox="0 0 24 24" fill="none">
            <path d="M3 3v5h5M21 21v-5h-5M4 12a8 8 0 0 1 16 0M20 12a8 8 0 0 1-16 0" 
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          L√†m m·ªõi
        </button>
      </div>
    </div>
  </section>

  <!-- Statistics Overview -->
  <section class="stats-section" [@counterAnimation] *ngIf="!isStatsLoading">
    <div class="stats-grid">
      <!-- Total Employees -->
      <div class="stat-card stat-primary" data-aos="fade-up" data-aos-delay="0">
        <div class="stat-content">
          <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
              <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
              <path d="m22 21-3-3m0 0-3-3m3 3-3 3m3-3h-8" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="stat-data">
            <div class="stat-number">{{ getAnimatedNumber('totalEmployees') }}</div>
            <div class="stat-label">T·ªïng nh√¢n vi√™n</div>
            <div class="stat-trend positive">
              <span class="trend-icon">‚Üó</span>
              <span>+{{ stats.employeeGrowth }}% th√°ng n√†y</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Active Employees -->
      <div class="stat-card stat-success" data-aos="fade-up" data-aos-delay="100">
        <div class="stat-content">
          <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
              <circle cx="8.5" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
              <polyline points="17,11 19,13 23,9" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="stat-data">
            <div class="stat-number">{{ getAnimatedNumber('activeEmployees') }}</div>
            <div class="stat-label">ƒêang l√†m vi·ªác</div>
            <div class="stat-trend positive">
              <span class="trend-icon">‚úì</span>
              <span>{{ ((stats.activeEmployees / stats.totalEmployees) * 100 | number:'1.0-0') || 0 }}% t·ªïng s·ªë</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Departments -->
      <div class="stat-card stat-info" data-aos="fade-up" data-aos-delay="200">
        <div class="stat-content">
          <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M3 21h18M4 21V8a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v13M12 8v13M16 8h2a1 1 0 0 1 1 1v12" 
                    stroke="currentColor" stroke-width="2"/>
              <path d="M6 4h2v2H6zM10 4h2v2h-2zM14 4h2v2h-2z" fill="currentColor"/>
            </svg>
          </div>
          <div class="stat-data">
            <div class="stat-number">{{ getAnimatedNumber('totalDepartments') }}</div>
            <div class="stat-label">Ph√≤ng ban</div>
            <div class="stat-trend neutral">
              <span class="trend-icon">üè¢</span>
              <span>T·ªï ch·ª©c ·ªïn ƒë·ªãnh</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Today's Shifts -->
      <div class="stat-card stat-warning" data-aos="fade-up" data-aos-delay="300">
        <div class="stat-content">
          <div class="stat-icon">
            <svg viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="stat-data">
            <div class="stat-number">{{ getAnimatedNumber('todayShifts') }}</div>
            <div class="stat-label">Ca h√¥m nay</div>
            <div class="stat-trend positive">
              <span class="trend-icon">üìÖ</span>
              <span>{{ stats.shiftCompletion }}% ho√†n th√†nh</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Quick Actions -->
  <section class="quick-actions-section">
    <div class="section-header">
      <h2 class="section-title">Thao t√°c nhanh</h2>
      <p class="section-subtitle">C√°c t√°c v·ª• th∆∞·ªùng xuy√™n s·ª≠ d·ª•ng</p>
    </div>
    
    <div class="quick-actions-grid" [@listAnimation]>
      <div 
        *ngFor="let action of filteredQuickActions; trackBy: trackByAction"
        class="action-card action-{{ action.color }}"
        [class.action-disabled]="action.disabled"
        (click)="executeQuickAction(action)"
        [@actionHover]="action.id"
        data-aos="zoom-in"
        [attr.data-aos-delay]="filteredQuickActions.indexOf(action) * 50">
        
        <div class="action-content">
          <div class="action-icon">
            <span class="icon-emoji">{{ action.icon }}</span>
          </div>
          <div class="action-info">
            <h3 class="action-title">{{ action.title }}</h3>
            <p class="action-description">{{ action.description }}</p>
          </div>
          <div class="action-arrow">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M5 12h14m-7-7 7 7-7 7" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
        </div>
        
        <div class="action-ripple"></div>
      </div>
    </div>
  </section>

  <!-- Main Content Grid -->
  <div class="content-grid">
    
    <!-- Recent Employees -->
    <section class="content-card employees-card" data-aos="fade-right">
      <div class="card-header">
        <h3 class="card-title">
          <svg class="card-icon" viewBox="0 0 24 24" fill="none">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
            <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
          </svg>
          Nh√¢n vi√™n m·ªõi nh·∫•t
        </h3>
        <button class="view-all-btn" (click)="viewAllEmployees()">
          Xem t·∫•t c·∫£
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M5 12h14m-7-7 7 7-7 7" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>
      
      <div class="card-content">
        <div class="employees-list" *ngIf="recentEmployees.length > 0; else noEmployees">
          <div 
            *ngFor="let employee of recentEmployees; trackBy: trackByEmployee"
            class="employee-item"
            [@listAnimation]>
            <div class="employee-avatar">
              <div class="avatar-placeholder">
                {{ employee.fullName.charAt(0).toUpperCase() }}
              </div>
            </div>
            <div class="employee-info">
              <div class="employee-name">{{ employee.fullName }}</div>
              <div class="employee-details">
                <span class="employee-code">{{ employee.employeeCode }}</span>
                <span class="employee-department">{{ employee.departmentId ? 'Ph√≤ng ' + employee.departmentId : 'Ch∆∞a ph√¢n b·ªï' }}</span>
              </div>
            </div>
            <div class="employee-status">
              <span class="status-badge" [class.active]="employee.isActive">
                {{ employee.isActive ? 'Ho·∫°t ƒë·ªông' : 'T·∫°m d·ª´ng' }}
              </span>
            </div>
          </div>
        </div>
        
        <ng-template #noEmployees>
          <div class="empty-state">
            <div class="empty-icon">üë•</div>
            <div class="empty-text">Ch∆∞a c√≥ nh√¢n vi√™n n√†o</div>
          </div>
        </ng-template>
      </div>
    </section>

    <!-- Today's Shifts -->
    <section class="content-card shifts-card" data-aos="fade-left">
      <div class="card-header">
        <h3 class="card-title">
          <svg class="card-icon" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2"/>
          </svg>
          Ca l√†m h√¥m nay
        </h3>
        <button class="view-all-btn" (click)="viewAllShifts()">
          Xem t·∫•t c·∫£
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M5 12h14m-7-7 7 7-7 7" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>
      
      <div class="card-content">
        <div class="shifts-list" *ngIf="todayShifts.length > 0; else noShifts">
          <div 
            *ngFor="let shift of todayShifts; trackBy: trackByShift"
            class="shift-item"
            [@listAnimation]>
            <div class="shift-time">
              <div class="time-range">
                <span class="start-time">{{ shift.startTime.substring(0, 5) }}</span>
                <span class="time-separator">-</span>
                <span class="end-time">{{ shift.endTime.substring(0, 5) }}</span>
              </div>
              <div class="shift-duration">{{ shift.totalHours }}h</div>
            </div>
            <div class="shift-info">
              <div class="shift-employee">{{ shift.employeeName }}</div>
              <div class="shift-location">üìç {{ shift.workLocationName }}</div>
            </div>
            <div class="shift-status">
              <span class="status-indicator" [class.active]="shift.isActive"></span>
            </div>
          </div>
        </div>
        
        <ng-template #noShifts>
          <div class="empty-state">
            <div class="empty-icon">üìÖ</div>
            <div class="empty-text">Kh√¥ng c√≥ ca l√†m h√¥m nay</div>
          </div>
        </ng-template>
      </div>
    </section>

    <!-- Recent Activities -->
    <section class="content-card activities-card" data-aos="fade-up">
      <div class="card-header">
        <h3 class="card-title">
          <svg class="card-icon" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
            <path d="M12 1v6m0 6v6M1 12h6m6 0h6" stroke="currentColor" stroke-width="2"/>
          </svg>
          Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y
        </h3>
        <button class="view-all-btn" (click)="viewAllActivities()">
          Xem t·∫•t c·∫£
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M5 12h14m-7-7 7 7-7 7" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>
      
      <div class="card-content">
        <div class="activities-timeline" [@listAnimation]>
          <div 
            *ngFor="let activity of recentActivities; trackBy: trackByActivity"
            class="activity-item">
            <div class="activity-icon activity-{{ activity.color }}">
              <span>{{ activity.icon }}</span>
            </div>
            <div class="activity-content">
              <div class="activity-title">{{ activity.title }}</div>
              <div class="activity-description">{{ activity.description }}</div>
              <div class="activity-meta">
                <span class="activity-user">{{ activity.user }}</span>
                <span class="activity-time">{{ getRelativeTime(activity.timestamp) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Performance Overview (Future Implementation) -->
  <section class="performance-section" data-aos="fade-up" data-aos-delay="400">
    <div class="section-header">
      <h2 class="section-title">T·ªïng quan hi·ªáu su·∫•t</h2>
      <p class="section-subtitle">Theo d√µi c√°c ch·ªâ s·ªë quan tr·ªçng</p>
    </div>
    
    <div class="performance-grid">
      <div class="performance-card">
        <div class="performance-header">
          <h4>Hi·ªáu su·∫•t l√†m vi·ªác</h4>
          <span class="performance-value">{{ stats.shiftCompletion }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="stats.shiftCompletion"></div>
        </div>
      </div>
      
      <div class="performance-card">
        <div class="performance-header">
          <h4>T·ªïng gi·ªù l√†m</h4>
          <span class="performance-value">{{ formatNumber(stats.totalHours) }}h</span>
        </div>
        <div class="performance-trend positive">
          <span>‚Üó TƒÉng 12% so v·ªõi th√°ng tr∆∞·ªõc</span>
        </div>
      </div>
      
      <div class="performance-card">
        <div class="performance-header">
          <h4>Trung b√¨nh ca/ng√†y</h4>
          <span class="performance-value">{{ stats.avgShiftDuration }}h</span>
        </div>
        <div class="performance-trend neutral">
          <span>‚Üí ·ªîn ƒë·ªãnh</span>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" *ngIf="isLoading">
  <div class="loading-content">
    <div class="loading-spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
    </div>
    <div class="loading-text">ƒêang t·∫£i d·ªØ li·ªáu...</div>
  </div>
</div>
